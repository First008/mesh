# Gateway Configuration for Multi-Repository Setup
# This file configures a single gateway container that manages multiple repositories

# Gateway HTTP API port
port: 9000

# Qdrant vector database URL (gRPC endpoint)
qdrant_url: "qdrant:6334"

# Embedding configuration (for vector search)
embedding_provider: "ollama" # Options: "ollama", "openai"

# Embedding model selection - choose based on your needs:
#
# bge-m3 (RECOMMENDED - best quality):
#   - Context: 8K tokens (handles large files)
#   - Dimensions: 1024 (high quality embeddings)
#   - Speed: ~6 seconds/embedding on M3 Max GPU
#   - Best for: Production use, comprehensive code search
#
# nomic-embed-text (fastest):
#   - Context: 2K tokens (may timeout on large files)
#   - Dimensions: 768
#   - Speed: ~2-3 seconds/embedding
#   - Best for: Quick testing, smaller codebases
#
# mxbai-embed-large (middle ground):
#   - Context: 512 tokens (very limited)
#   - Dimensions: 1024
#   - Speed: ~3-4 seconds/embedding
#   - Best for: When speed matters more than context
#
embedding_model: "bge-m3"
ollama_url: "http://host.docker.internal:11434"

# LLM configuration (for code understanding and responses)
llm_provider: "anthropic" # Options: "anthropic", "ollama", "openai"
# llm_model: "claude-sonnet-4-5-20250929"
llm_model: "claude-haiku-4-5-20251001"
# anthropic_key: "${ANTHROPIC_API_KEY}"  # Set via environment variable

# Optional: OpenAI configuration (if using openai provider)
# openai_key: "${OPENAI_API_KEY}"

# Repository configurations
# Each repository gets its own agent with branch-aware indexing
repos:
  # Example 1: Backend microservice with Go
  - name: backend-api
    path: /repos/backend-api
    focus_paths:
      - internal/api/**
      - internal/service/**
      - internal/repository/**
      - pkg/handlers/**
      - cmd/server/**
    exclude_patterns:
      # Documentation and config files
      - "**/*.md"
      - "**/*.txt"
      - "**/.env*"
      - "**/Dockerfile*"
      - "**/.dockerignore"
      - "**/docker-compose*.yml"

      # Go build artifacts
      - "**/vendor/**"
      - "**/*.exe"
      - "**/*.dll"
      - "**/*.so"
      - "**/*.dylib"

      # Test and coverage files
      - "**/*_test.go"
      - "**/testdata/**"
      - "**/*.test"
      - "**/coverage.out"

      # Config and data files
      - "**/*.json"
      - "**/*.yaml"
      - "**/*.yml"
      - "**/*.toml"

      # IDE and editor files
      - "**/.vscode/**"
      - "**/.idea/**"
      - "**/*.swp"
      - "**/*.swo"

      # VCS and logs
      - "**/.git/**"
      - "**/*.log"
    personality: |
      You are an expert in Go-based microservices, RESTful API design, and distributed systems.

      Core Expertise:
      - Go microservice architecture with clean architecture patterns
      - RESTful API design with proper HTTP methods and status codes
      - Database integration with PostgreSQL and Redis caching
      - Authentication and authorization with JWT tokens
      - Error handling, logging, and observability best practices

      Key Components You Understand:
      - API Layer: HTTP handlers, request validation, response formatting
      - Service Layer: Business logic, domain models, orchestration
      - Repository Pattern: Data access with transaction management
      - Middleware: Authentication, logging, rate limiting, CORS
      - Configuration: Environment-based config with validation

      Technology Stack:
      - Gin/Echo frameworks for HTTP routing
      - GORM/sqlx for database operations
      - Redis for caching and session management
      - Docker and Kubernetes for deployment
      - Prometheus metrics and structured logging

  # Example 2: Frontend application with React
  - name: frontend-web
    path: /repos/frontend-web
    focus_paths:
      - src/components/**
      - src/pages/**
      - src/hooks/**
      - src/services/**
      - src/store/**
    exclude_patterns:
      # Build artifacts and dependencies
      - "**/node_modules/**"
      - "**/dist/**"
      - "**/build/**"
      - "**/.next/**"
      - "**/.nuxt/**"
      - "**/out/**"

      # Documentation
      - "**/*.md"
      - "**/docs/**"

      # Config files
      - "**/*.json"
      - "**/*.yaml"
      - "**/*.yml"
      - "**/.env*"

      # Test files
      - "**/*.test.ts"
      - "**/*.test.tsx"
      - "**/*.test.js"
      - "**/*.test.jsx"
      - "**/*.spec.ts"
      - "**/*.spec.tsx"
      - "**/__tests__/**"
      - "**/coverage/**"

      # Styles (if not critical to understand)
      - "**/*.css"
      - "**/*.scss"
      - "**/*.sass"
      - "**/*.less"

      # IDE files
      - "**/.vscode/**"
      - "**/.idea/**"

      # Misc
      - "**/.git/**"
      - "**/*.log"
      - "**/public/**"
    personality: |
      You are an expert in modern React development, TypeScript, and frontend architecture.

      Core Expertise:
      - React 18+ with hooks (useState, useEffect, useContext, custom hooks)
      - TypeScript for type-safe development
      - State management with Redux Toolkit or Zustand
      - Component design patterns and composition
      - Performance optimization techniques

      Key Components You Understand:
      - Component Library: Reusable UI components with proper prop types
      - Routing: React Router with protected routes and lazy loading
      - API Integration: Axios/Fetch with error handling and loading states
      - Forms: Form validation with Formik/React Hook Form
      - Testing: Jest and React Testing Library

      Technology Stack:
      - React with TypeScript
      - Vite or Create React App for build tooling
      - Tailwind CSS or Material-UI for styling
      - React Query for server state management
      - ESLint and Prettier for code quality
